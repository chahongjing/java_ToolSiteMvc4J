<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjy.bll.dao.UserInfoDao">
	<!-- 基本操作区 -->
	<!-- 添加 -->
	<insert id="add">
		INSERT INTO userinfo(<include refid="field"></include>)
		VALUES(#{userGuid, jdbcType=VARCHAR}, #{userCode, jdbcType=VARCHAR}, #{userName, jdbcType=VARCHAR}, #{password, jdbcType=VARCHAR},
		#{sex, jdbcType=INTEGER}, #{birthday, jdbcType=TIMESTAMP}, #{isSystem, jdbcType=BOOLEAN}, #{isDisabled, jdbcType=BOOLEAN})
	</insert>

	<!-- 更新 -->
	<update id="update">
        update userinfo
        <set>
			<if test='userName != null and userName != ""'>
				UserName = #{userName, jdbcType=VARCHAR},
			</if>
			<if test='password != null and password != ""'>
				Password = #{password, jdbcType=VARCHAR},
			</if>
			<if test='sex != null'>
				Sex = #{sex, jdbcType=INTEGER},
			</if>
			<if test='birthday != null'>
				Birthday = #{birthday, jdbcType=TIMESTAMP},
			</if>
			<if test='isSystem != null'>
				IsSystem = #{isSystem, jdbcType=BOOLEAN},
			</if>
			<if test='isDisabled != null'>
				isDisabled = #{isDisabled, jdbcType=BOOLEAN},
			</if>
		</set>
         where UserGuid = #{userGuid, jdbcType=VARCHAR}
	</update>

	<!-- 删除 -->
	<delete id="delete">
		DELETE FROM userinfo WHERE UserGuid = #{id, jdbcType=VARCHAR}
	</delete>

	<!-- 获取 -->
	<select id="get" resultType="com.zjy.bll.vo.UserInfoVo">
		SELECT <include refid="fieldWithPrefix"><property name="tableName" value="UserInfo"/></include>
		  FROM UserInfo
		 WHERE userguid = #{id, jdbcType = VARCHAR}
	</select>

	<!-- 查询简单列表 -->
	<select id="query" resultType="com.zjy.entities.UserInfo">
		SELECT <include refid="fieldWithPrefix"><property name="tableName" value="UserInfo"/></include>
		FROM UserInfo
		WHERE 1 = 1
		<if test='userName != null and userName != ""'>
			and (userName like '%' || #{userName, jdbcType=VARCHAR} || '%' or userCode like '%' || #{userName, jdbcType=VARCHAR} || '%')
		</if>
	</select>

	<!-- 查询复杂列表 -->
	<select id="queryByMapFilter" resultType="com.zjy.bll.vo.UserInfoVo">
		SELECT <include refid="fieldWithPrefix"><property name="tableName" value="UserInfo"/></include>
		FROM UserInfo
		WHERE 2 = 2
	</select>

	<!-- 通过编码获取 -->
	<select id="getByCode" resultType="com.zjy.entities.UserInfo">
		SELECT <include refid="fieldWithPrefix"><property name="tableName" value="UserInfo"/></include>
		  FROM UserInfo
		 WHERE userCode = #{userCode, jdbcType = VARCHAR}
	</select>

	<!-- 查询是否重复 -->
	<select id="queryRepeatCount" resultType="Map">
		select count(case when userCode = #{userCode, jdbcType=VARCHAR} then 1 else null end) as codeCount
		  from UserInfo
		 where UserGuid &lt;&gt; #{userGuid, jdbcType=VARCHAR}
	</select>

	<!-- 其它操作区 -->


	<!-- 公共信息 -->
	<!-- 字段 -->
	<sql id="field">
		UserGuid, UserCode, UserName, Password, Sex, Birthday, IsSystem, isDisabled
	</sql>
	 <!-- 带前缀的字段 -->
	<sql id="fieldWithPrefix">
		${tableName}.UserGuid, ${tableName}.UserCode, ${tableName}.UserName, ${tableName}.Password, ${tableName}.Sex,
		${tableName}.Birthday, ${tableName}.IsSystem, ${tableName}.isDisabled
	</sql>
</mapper>