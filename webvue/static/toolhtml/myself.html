<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'> 
	<title>总结</title>
	<link rel='stylesheet' type='text/css' href='../bootstrap/css/bootstrap.min.css'>
	<link rel='stylesheet' type='text/css' href='../css/common.css'>
</head> 
<body class='elearn'>
	<h2>科大讯飞股份有限公司</h2>
	<ul class='list'>
		<li>核心逻辑开发，公共模块提炼。试题编辑公共指令，试卷组卷公共指令。试题保存逻辑升级，以前是直接上传到ftp，新方案是先上传到web，然后业务数据处理完成后再把文件上传到ftp。业务数据使用模板化，before,after。</li>
		<li>使用多线程处理word生成预览图片，ScheduledThreadPool，对于生成图片请求先放到一个ConcurrentQueue中线程每隔5秒就从queue获取数据并处理，</li>
		<li>独立项目搭建设计开发部署。方案为java + springmvc + mybatis + webpack + vue，权限方案使用shiro, 另mybatis使用枚举通用方案实现。</li>
		<li>性能优化。多使用工具，如apache commonutils，也可以减小sonarlint提示的bug</li>
		<li>带新人，做一些疑难指导，做一些培训工作。如参数传递方式等，mybatis缓存问题，环境部署问题。</li>
		<li>生产数据上线。程序，数据库备份还原等。客户现场支持。</li>
	</ul>
	<hr>
	<h2>原因</h2>
	<ul class="list">
		<li>公司文件氛围不好，甲荃事件，没有窗户，全靠人体净化器，在未得到测量结果之前让我们搬进去。公司大部分都戴口罩上班，
			很多同事包括我喉咙发炎，身上痒。领导都扛不住了，说你们怎么不反抗。员工就在群里反馈，说公司不太注重员工健康，也不整改。
			因为这事反馈的员工被辞退，公司的群被解散，创建小群要上报。</li>
		<li>公司权利斗争很严重，每周都有人事任命邮件，因为工位调整起争执</li>
		<li>涨薪没有标准</li>
	</ul>
	<hr>
	<h2>大博科技有限公司</h2>
	<ul class='list'>
		<li>支付宝支付url中携带金额参数，去掉直接从订单中获取。</li>
		<li>用户登录模块有推荐抽成功能，被攻击了一个星期。查明原因为图片验证码的code放在了cookie中，导致被恶意劫持绕过图片验证码进行攻击，但手机验证码还不清楚原因。也添加了同一ip多次访问拉黑名单设置</li>
		<li>后台修改价格出售然后又改回来，后来财务对账时发现账对不上，查日志找到操作记录。</li>
		<li>分布式缓存问题。两台服务器发送请求，本机的缓存都没有会同时去获取新的token导致只有一个token是最新，改用redis分布式缓存解决问题。</li>
		<li>缓存击穿问题调用微信所有接口都要使用token，而获取token则先要用微信公众号中的parterkey去调用获取token接口获取。token有过期时间如一个小时。因服务器使用集群部署，nginx导流到两个webserver。这个时间当token在失效的一瞬间如果有两个或多个请求同时抵达，在业务代码中就会判断如果token过期，则去腾讯拿最新的token，如请求1和请求2同时抵达，token失效，这时请求1和2都会去拿最新token,请求1刚拿token1后2也去拿最新token2，因一个parterkey只能对应一个生效的token，所以此时请求1中拿到的新的token1会在拿到token2时立即失效，这时他又会去重新获取token3,当获取到时前面的token2也会立即失效，这样就会导致这两个请求一直请求失败，重复去拿token。解决方案是隔离获取token，因为有两台独立服务器，所有将获取token做成定时服务，功能是无论过不过期每隔半个小时去腾讯拿一个最新的token存储在redis中，而webserver两台服务器只负责从redis从获取，如果获取不到则循环等待。</li>
		<li>秒杀功能问题。业务要求是达到100tps。因是两台webserver,因此要对库存做并发处理。本地lock锁不住，只能使用分布式锁。技术限制，使用的是存储过程减库存，减库存数量时使用sqlserver表的行级锁。后续积累过程中了解到可以使用redis的setnx实现。这也是比较推荐的方案，还有一种方案就是使用zookeeper实现，这个还要研究下。通过数据库实现，测试使用LoaderRunner自动化测试满足100tps要求。</li>
		<li>下单，支付，退货，优惠券功能</li>
	</ul>
	<hr>
	<h2>原因</h2>
	<ul class="list">
		<li>公司拖欠工资3个月</li>
	</ul>
	<hr>
	<h2>明源云股份有限公司</h2>
	<ul class='list'>
		<li>手工写自己的mvc, 通过httpmodule处理全局请求，通过httphandler处理分类请求达到效果，如/controller/action?参数=xx通过拆分url找到对应的class和里面的action,然后调用。性能优化，在调用请求时判断有没有缓存，如果有，直接使用，如果没有，则通过反射查找。程序启动时扫描系统所有程序集找到所有继承controller的类，并找到标记有特殊特性如AjaxAction的方法，然后解析方法，参数，缓存起来。</li>
		<li>entity。解决大量公用crud操作，每个实体不用重复写sql。并且提供较高的性能。初版本DbHelper，都是静态方法调用。二版本继承baseentity，实现基本crud操作，通过反射，找到实体所有字段拼接成四种操作的sql并缓存。三版本使用线程静态变量缓存数据库信息，可在顶层实现中启用事务，在操作中调用其它方法时会共用上层事务，通过Stack实现。四版本使用动态编译，提供与手工ado相近的性能优化，程序运行时扫描所有程序集，找到实现baseentity的实体，这些实体都是partial类，然后通过反射生成和每个实体同名的partial类扩展crud操作。然后将类的字段串进行编译，加载，这样就实现了性能较高的crud公共数据库操作。update实现比较复杂主要是针对null字段，默认所有null字段不处理，如果要处理则生成的partial类中有可设置强制更新的字段设置，这样在生成的update语句中就可以更新为null字段的值了。</li>
		<li>重构系统要对图片文件迁移到新系统，包括数据和图片文件，单线程执行预计算了时间要2天左右才能完成。然后使用多线程。信号量，每次处理20条数据，在后台发送http请求上传图片，处理业务数据。使用多线程方式实现30分钟左右就完成了工作。</li>
		<li>当时有个请假扣工时的bug排查了两天都没有找出原因，只能修数据。存储过程使用游标，有一个变量赋值的操作有问题，且只会在连续请两天假才会出现，我看了一上午也没看出问题，偶然见觉得这个有问题，仔细一看果然是这里有问题，最后问题解决</li>
	</ul>
	<h2>原因</h2>
	<ul class="list">
		<li>内部部门，涨薪慢</li>
	</ul>
	<hr>
	<hr>
	<h2>性能优化</h2>
	<ul class="list">
		<li>java优化
			<ul class="list">
				<li>单例</li>
				<li>少使用反射，缓存起来？</li>
				<li>静态函数，可以内联</li>
				<li>基本数据类型等减小内存回收压力</li>
				<li>bufferedoutputstream</li>
				<li>try catch和synchronized放在循环外</li>
				<li>使用连接池</li>
				<li>缓存正则</li>
				<li>EnumSet</li>
				<li>确定数组初始大小，以免扩容</li>
				<li>stream.anyMatch</li>
				<li>做统计时使用parallel()。</li>
				<li>减少锁的范围</li>
			</ul>
		</li>
		<li>数据库优化优化
			<ul class="list">
				<li>索引优化，在查询列上添加索引。</li>
				<li>10w条数据通过mybatis查询要16秒，改成手工jdbc操作，resultset直接getInt获取数据优化到3s。</li>
				<li>冗余字段</li>
				<li>小表关联大表</li>
				<li>不在循环中查询数据库</li>
				<li>选择合适的字段属性</li>
				<li>尽量使用连接</li>
				<li>过滤列中尽量有索引，like去掉前面的%，列上不作计算</li>
				<li>只取需要的列，不能用*</li>
				<li>not in不会走索引，使用not exists代替</li>
				<li>union all</li>
				<li>&lt;&gt;改成&gt; and &lt;会走索引</li>
				<li>避免类型转换</li>
			</ul>
		</li>
		<li>js，html，css优化
			<ul class="list">
				<li>样式层次不要太深</li>
				<li>dom操作先处理好字符串再添加到dom中</li>
				<li>js中字符串拼接用array.join</li>
				<li>局部变量</li>
				<li>mvvm中把数据处理好之后再提交到view，避免多次执行</li>
				<li>静态资源合并减少请求数量</li>
				<li>图片sprite</li>
			</ul>
		</li>
	</ul>
	<hr>
	<h2>自我评价<h2>
	<ul>
	    <li>在工作上认真负责，富有耐心，上进心强，适应能力强，能够吃苦耐劳；</li>
        <li>在技术上喜欢不断研究，学习热情度高，喜欢阅读一些专业书籍，看论坛中的技术贴；</li>
        <li>在和同事相处中为人和睦，具有良好的团队合作精神，倾听能力与较好的个人亲和力，热爱团队工作；</li>
        <li>在生活中乐观开朗，积极向上</li>
	</ul>
	<hr>
	<h2>问题</h2>
	<ul class="list">
		<li>团队所负责业务，短期规划和长期规划</li>
		<li>团队对我的期望</li>
		<li>人才培养</li>
		<li>晋升机制，涨薪机制</li>
	</ul>
</body> 
</html>